jQuery(function(_){"use strict";var s={init:function(){s.process_avatar_upload()},process_avatar_upload:function(){_("body").on("change",'.wpmake-user-avatar-upload-node input[type="file"]',function(){var a;this.files&&this.files[0]&&((a=new FileReader).onload=function(a){_(".img").attr("src",a.target.result)},a.readAsDataURL(this.files[0]),wpmake_user_avatar_params.wpmake_user_avatar_enable_cropping_interface?(Swal.fire({title:wpmake_user_avatar_params.wpmake_user_avatar_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:wpmake_user_avatar_params.wpmake_user_avatar_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:wpmake_user_avatar_params.wpmake_user_avatar_cancel_button,customClass:{container:"wpmake-user-avatar-swal2-container"}}),_(".swal2-cancel ").on("click",function(){_(".wpmake-user-avatar-upload").find("#wpmake-user-avatar-pic").val("")}),s.crop_image(_(this))):s.send_file(_(this)))})},crop_image:function(e){var r;_("#crop_container").Jcrop({aspectRatio:1,onSelect:function(a){r={x:a.x,y:a.y,w:a.w,h:a.h}},setSelect:[100,100,50,50]}),_(".swal2-confirm").on("click",function(){var a={x:r.x,y:r.y,w:r.w,h:r.h,holder_width:_("#crop_container").css("width"),holder_height:_("#crop_container").css("height")};_(".cropped_image_size").val(JSON.stringify(a)),s.send_file(e)})},remove_avatar:function(e){var a=wpmake_user_avatar_params.ajax_url+"?action=wpmake_user_avatar_upload_remove_avatar&security="+wpmake_user_avatar_params.wpmake_user_avatar_remove_nonce;_.ajax({url:a,type:"POST",beforeSend:function(){e.text(wpmake_user_avatar_params.wpmake_user_avatar_removing),e.closest(".wpmake-user-avatar-upload").find("#wpmake-user-avatar-pic").val(""),e.closest(".wpmake-user-avatar-upload").find(".wpmake-user-avatar-input").val(""),e.closest(".wpmake-user-avatar-upload").find(".wpmake-user-avatar-error").remove(),_(".profile-preview").attr("src","https://secure.gravatar.com/avatar/?s=96&d=mm&r=g")},complete:function(a){e.closest(".wpmake-user-avatar-upload").find(".wpmake-user-avatar-remove").attr("style","display:none"),e.closest(".wpmake-user-avatar-upload").find(".wpmake_user_avatar_take_snapshot ").removeAttr("style"),e.closest(".wpmake-user-avatar-upload").find(".wpmake_user_avatar_upload ").removeAttr("style"),e.closest(".wpmake-user-avatar-upload").find('input[type="file"]').off("click")}})},send_file:function(n){var a=wpmake_user_avatar_params.ajax_url+"?action=wpmake_user_avatar_upload_method_upload&security="+wpmake_user_avatar_params.wpmake_user_avatar_upload_nonce,e=new FormData,r="",o=(wpmake_user_avatar_params.wpmake_user_avatar_enable_cropping_interface?r=_("#crop_container").attr("src"):(r=_("#blob_container").attr("src"),console.log("2")),n[0].files[0]?e.append("file",n[0].files[0]):(r=s.dataURItoBlob(r),r=new File([r],"snapshot.jpg"),e.append("file",r)),e.append("cropped_image",_(".cropped_image_size").val()),e.append("valid_extension",_('input[name="profile-pic"]').attr("accept")),e.append("max_uploaded_size",_('input[name="profile-pic"]').attr("size")),n.closest(".wpmake-user-avatar-upload").find(".wp_wpmake_user_avatar_upload")),i=o.text();_.ajax({url:a,data:e,type:"POST",processData:!1,contentType:!1,beforeSend:function(){o.text(wpmake_user_avatar_params.wpmake_user_avatar_uploading)},complete:function(a){var e,r="",t=0;n.parent().parent().parent().find(".wpmake-user-avatar-error").remove(),n.closest(".wpmake-user-avatar-upload").find(".wpmake-user-avatar-input").val("");try{var s=JSON.parse(a.responseText);if("undefined"==typeof s.success||"undefined"==typeof s.data)throw wpmake_user_avatar_params.wpmake_user_avatar_something_wrong;r=s.data.message,s.success||(r='<p class="wpmake-user-avatar-file-error">'+r+"</p>"),s.success&&(r="",t=s.data.attachment_id,e=s.data.profile_picture_url,_(".wpmake-user-avatar-container").find(".profile-preview").attr("src",e),n.closest(".wpmake-user-avatar-upload").find(".profile-preview").attr("src",e),n.closest(".wpmake-user-avatar-upload").find(".wpmake-user-avatar-remove").removeAttr("style"),n.closest(".wpmake-user-avatar-upload").find(".wpmake_user_avatar_take_snapshot ").attr("style","display:none"),n.closest(".wpmake-user-avatar-upload").find(".wpmake_user_avatar_upload ").attr("style","display:none"))}catch(p){r=wpmake_user_avatar_params.wpmake_user_avatar_something_wrong}n.closest(".wpmake-user-avatar-upload").find(".wpmake-user-avatar-error").remove(),n.closest(".wpmake-user-avatar-upload").find(".wpmake-user-avatar-file-error").remove(),n.closest(".wpmake-user-avatar-upload").append('<span class="wpmake-user-avatar-error">'+r+"</span>"),0<t&&n.closest(".wpmake-user-avatar-upload").find(".wpmake-user-avatar-input").val(t),o.text(i)}})},dataURItoBlob:function(a){for(var e=(0<=a.split(",")[0].indexOf("base64")?atob:unescape)(a.split(",")[1]),a=a.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return new Blob([r],{type:a})}};s.init(jQuery),_(document).on("click",".wpmake_user_avatar_upload",function(){_(this).closest(".wpmake-user-avatar-upload").find('input[type="file"]').trigger("click")}),_(document).on("click",".wpmake_user_avatar_take_snapshot",function(){var e=_(this),a=(Swal.fire({title:wpmake_user_avatar_params.wpmake_user_avatar_capture,html:'<div id="my_camera"></div>',confirmButtonText:wpmake_user_avatar_params.wpmake_user_avatar_capture,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:wpmake_user_avatar_params.wpmake_user_avatar_cancel_button,customClass:{container:"wpmake-user-avatar-swal2-container"}}),320),r=240,t=(_(window).width()<_(window).height()&&(a=240,r=320),Webcam.set({width:a,height:r,dest_width:a,dest_height:r,crop_width:a,crop_height:r,image_format:"jpeg",jpeg_quality:90}),!1);Webcam.on("error",function(a){var e="",r="",r="WebcamError"===a.name?(e=wpmake_user_avatar_params.wpmake_user_avatar_ssl_error_title,wpmake_user_avatar_params.wpmake_user_avatar_ssl_error_text):(e=wpmake_user_avatar_params.wpmake_user_avatar_permission_error_title,wpmake_user_avatar_params.wpmake_user_avatar_permission_error_text);t=!0,swal.fire({icon:"warning",title:e,html:r,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpmake_user_avatar_params.wpmake_user_avatar_cancel_button_confirmation,cancelButtonColor:"#236bb0",customClass:{container:"wpmake-user-avatar-swal2-container"}})}),t||(Webcam.attach("#my_camera"),_(".swal2-html-container").attr("style","display: flex;align-items: center;justify-content: center;"),_(".swal2-confirm").on("click",function(){Webcam.snap(function(a){wpmake_user_avatar_params.wpmake_user_avatar_enable_cropping_interface?(Swal.fire({title:wpmake_user_avatar_params.wpmake_user_avatar_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:wpmake_user_avatar_params.wpmake_user_avatar_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:wpmake_user_avatar_params.wpmake_user_avatar_cancel_button,customClass:{container:"wpmake-user-avatar-swal2-container"}}),_(".swal2-html-container").attr("style","display: flex;align-items: center;justify-content: center;"),_("#crop_container").attr("src",a),s.crop_image(e.closest(".wpmake-user-avatar-upload").find('.wpmake-user-avatar-upload-node input[type="file"]'))):(e.closest(".wpmake-user-avatar-upload").append('<img id="blob_container" src="'+a+'" alt="your image" class="img" style="display:none;"/>'),s.send_file(e.closest(".wpmake-user-avatar-upload").find('.wpmake-user-avatar-upload-node input[type="file"]')))}),Webcam.reset()}),_(".swal2-cancel").on("click",function(){Webcam.reset()}))}),_(document).on("click",".wpmake-user-avatar-remove",function(){s.remove_avatar(_(this))})});