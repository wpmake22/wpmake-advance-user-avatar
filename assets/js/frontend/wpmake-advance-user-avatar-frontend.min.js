jQuery(function(o){"use strict";var n={init:function(){n.process_avatar_upload()},process_avatar_upload:function(){o("body").on("change",'.wpmake-advance-user-avatar-upload-node input[type="file"]',function(){var a;this.files&&this.files[0]&&((a=new FileReader).onload=function(a){o(".img").attr("src",a.target.result)},a.readAsDataURL(this.files[0]),wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_enable_cropping_interface?(Swal.fire({title:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_cancel_button,customClass:{container:"wpmake-advance-user-avatar-swal2-container"}}),o(".swal2-cancel ").on("click",function(){o(".wpmake-advance-user-avatar-upload").find("#wpmake-advance-user-avatar-pic").val("")}),n.crop_image(o(this))):n.send_file(o(this)))})},crop_image:function(e){var r;o("#crop_container").Jcrop({aspectRatio:1,boxWidth:400,boxHeight:400,onSelect:function(a){r={x:a.x,y:a.y,w:a.w,h:a.h}},setSelect:[100,100,50,50]}),o(".swal2-confirm").on("click",function(){var a={x:r.x,y:r.y,w:r.w,h:r.h,holder_width:o("#crop_container").css("width"),holder_height:o("#crop_container").css("height")};o(".cropped_image_size").val(JSON.stringify(a)),n.send_file(e)})},remove_avatar:function(e){var a=wpmake_advance_user_avatar_params.ajax_url+"?action=wpmake_advance_user_avatar_upload_remove_avatar&security="+wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_remove_nonce;o.ajax({url:a,type:"POST",beforeSend:function(){e.text(wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_removing),e.closest(".wpmake-advance-user-avatar-upload").find("#wpmake-advance-user-avatar-pic").val(""),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-input").val(""),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-error").remove(),o(".profile-preview").attr("src","https://secure.gravatar.com/avatar/?s=96&d=mm&r=g")},complete:function(a){e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-remove").attr("style","display:none"),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake_advance_user_avatar_take_snapshot ").removeAttr("style"),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake_advance_user_avatar_upload ").removeAttr("style"),e.closest(".wpmake-advance-user-avatar-upload").find('input[type="file"]').off("click")}})},send_file:function(c){var a=wpmake_advance_user_avatar_params.ajax_url+"?action=wpmake_advance_user_avatar_upload_method_upload&security="+wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_upload_nonce,e=new FormData,r="",_=(wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_enable_cropping_interface?r=o("#crop_container").attr("src"):(r=o("#blob_container").attr("src"),console.log("2")),c[0].files[0]?e.append("file",c[0].files[0]):(r=n.dataURItoBlob(r),r=new File([r],"snapshot.jpg"),e.append("file",r)),e.append("cropped_image",o(".cropped_image_size").val()),e.append("valid_extension",o('input[name="profile-pic"]').attr("accept")),e.append("max_uploaded_size",o('input[name="profile-pic"]').attr("size")),c.closest(".wpmake-advance-user-avatar-upload").find(".wp_wpmake_advance_user_avatar_upload")),p=_.text();o.ajax({url:a,data:e,type:"POST",processData:!1,contentType:!1,beforeSend:function(){_.text(wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_uploading)},complete:function(a){var e,r="",t=0;c.parent().parent().parent().find(".wpmake-advance-user-avatar-error").remove(),c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-input").val("");try{var n=JSON.parse(a.responseText);if("undefined"==typeof n.success||"undefined"==typeof n.data)throw wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_something_wrong;r=n.data.message,n.success||(r='<p class="wpmake-advance-user-avatar-file-error">'+r+"</p>"),n.success&&(r="",t=n.data.attachment_id,e=n.data.profile_picture_url,o(".wpmake-advance-user-avatar-container").find(".profile-preview").attr("src",e),c.closest(".wpmake-advance-user-avatar-upload").find(".profile-preview").attr("src",e),c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-remove").removeAttr("style"),c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake_advance_user_avatar_take_snapshot ").attr("style","display:none"),c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake_advance_user_avatar_upload ").attr("style","display:none"))}catch(s){r=wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_something_wrong}c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-error").remove(),c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-file-error").remove(),c.closest(".wpmake-advance-user-avatar-upload").append('<span class="wpmake-advance-user-avatar-error">'+r+"</span>"),0<t&&c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-input").val(t),_.text(p)}})},dataURItoBlob:function(a){for(var e=(0<=a.split(",")[0].indexOf("base64")?atob:unescape)(a.split(",")[1]),a=a.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return new Blob([r],{type:a})}};n.init(jQuery),o(document).on("click",".wpmake_advance_user_avatar_upload",function(){o(this).closest(".wpmake-advance-user-avatar-upload").find('input[type="file"]').trigger("click")}),o(document).on("click",".wpmake_advance_user_avatar_take_snapshot",function(){var e=o(this),a=(Swal.fire({title:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_capture,html:'<div id="my_camera"></div>',confirmButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_capture,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_cancel_button,customClass:{container:"wpmake-advance-user-avatar-swal2-container"}}),320),r=240,t=(o(window).width()<o(window).height()&&(a=240,r=320),Webcam.set({width:a,height:r,dest_width:a,dest_height:r,crop_width:a,crop_height:r,image_format:"jpeg",jpeg_quality:90}),!1);Webcam.on("error",function(a){var e="",r="",r="WebcamError"===a.name?(e=wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_ssl_error_title,wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_ssl_error_text):(e=wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_permission_error_title,wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_permission_error_text);t=!0,swal.fire({icon:"warning",title:e,html:r,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_cancel_button_confirmation,cancelButtonColor:"#236bb0",customClass:{container:"wpmake-advance-user-avatar-swal2-container"}})}),t||(Webcam.attach("#my_camera"),o(".swal2-html-container").attr("style","display: flex;align-items: center;justify-content: center;"),o(".swal2-confirm").on("click",function(){Webcam.snap(function(a){wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_enable_cropping_interface?(Swal.fire({title:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_cancel_button,customClass:{container:"wpmake-advance-user-avatar-swal2-container"}}),o(".swal2-html-container").attr("style","display: flex;align-items: center;justify-content: center;"),o("#crop_container").attr("src",a),n.crop_image(e.closest(".wpmake-advance-user-avatar-upload").find('.wpmake-advance-user-avatar-upload-node input[type="file"]'))):(e.closest(".wpmake-advance-user-avatar-upload").append('<img id="blob_container" src="'+a+'" alt="your image" class="img" style="display:none;"/>'),n.send_file(e.closest(".wpmake-advance-user-avatar-upload").find('.wpmake-advance-user-avatar-upload-node input[type="file"]')))}),Webcam.reset()}),o(".swal2-cancel").on("click",function(){Webcam.reset()}))}),o(document).on("click",".wpmake-advance-user-avatar-remove",function(){n.remove_avatar(o(this))})});