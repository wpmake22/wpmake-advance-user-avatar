jQuery(function(i){"use strict";var n={init:function(){n.process_avatar_upload()},process_avatar_upload:function(){i("body").on("change",'.wpmake-advance-user-avatar-upload-node input[type="file"]',function(){var a;this.files&&this.files[0]&&((a=new FileReader).onload=function(a){i(".img").attr("src",a.target.result)},a.readAsDataURL(this.files[0]),WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_enable_cropping_interface?(Swal.fire({title:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_cancel_button,customClass:{container:"wpmake-advance-user-avatar-swal2-container"}}),i(".swal2-cancel ").on("click",function(){i(".wpmake-advance-user-avatar-upload").find("#wpmake-advance-user-avatar-pic").val("")}),n.crop_image(i(this))):n.send_file(i(this)))})},crop_image:function(e){var r;i("#crop_container").Jcrop({aspectRatio:1,onSelect:function(a){r={x:a.x,y:a.y,w:a.w,h:a.h}},setSelect:[100,100,50,50]}),i(".swal2-confirm").on("click",function(){var a={x:r.x,y:r.y,w:r.w,h:r.h,holder_width:i("#crop_container").css("width"),holder_height:i("#crop_container").css("height")};i(".cropped_image_size").val(JSON.stringify(a)),n.send_file(e)})},remove_avatar:function(e){var a=WPMake_Advance_User_Avatar_params.ajax_url+"?action=WPMake_Advance_User_Avatar_upload_remove_avatar&security="+WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_remove_nonce;i.ajax({url:a,type:"POST",beforeSend:function(){e.text(WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_removing),e.closest(".wpmake-advance-user-avatar-upload").find("#wpmake-advance-user-avatar-pic").val(""),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-input").val(""),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-error").remove(),i(".profile-preview").attr("src","https://secure.gravatar.com/avatar/?s=96&d=mm&r=g")},complete:function(a){e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-remove").attr("style","display:none"),e.closest(".wpmake-advance-user-avatar-upload").find(".WPMake_Advance_User_Avatar_take_snapshot ").removeAttr("style"),e.closest(".wpmake-advance-user-avatar-upload").find(".WPMake_Advance_User_Avatar_upload ").removeAttr("style"),e.closest(".wpmake-advance-user-avatar-upload").find('input[type="file"]').off("click")}})},send_file:function(c){var a=WPMake_Advance_User_Avatar_params.ajax_url+"?action=WPMake_Advance_User_Avatar_upload_method_upload&security="+WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_upload_nonce,e=new FormData,r="",_=(WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_enable_cropping_interface?r=i("#crop_container").attr("src"):(r=i("#blob_container").attr("src"),console.log("2")),c[0].files[0]?e.append("file",c[0].files[0]):(r=n.dataURItoBlob(r),r=new File([r],"snapshot.jpg"),e.append("file",r)),e.append("cropped_image",i(".cropped_image_size").val()),e.append("valid_extension",i('input[name="profile-pic"]').attr("accept")),e.append("max_uploaded_size",i('input[name="profile-pic"]').attr("size")),c.closest(".wpmake-advance-user-avatar-upload").find(".wp_WPMake_Advance_User_Avatar_upload")),o=_.text();i.ajax({url:a,data:e,type:"POST",processData:!1,contentType:!1,beforeSend:function(){_.text(WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_uploading)},complete:function(a){var e,r="",t=0;c.parent().parent().parent().find(".wpmake-advance-user-avatar-error").remove(),c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-input").val("");try{var n=JSON.parse(a.responseText);if("undefined"==typeof n.success||"undefined"==typeof n.data)throw WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_something_wrong;r=n.data.message,n.success||(r='<p class="wpmake-advance-user-avatar-file-error">'+r+"</p>"),n.success&&(r="",t=n.data.attachment_id,e=n.data.profile_picture_url,i(".wpmake-advance-user-avatar-container").find(".profile-preview").attr("src",e),c.closest(".wpmake-advance-user-avatar-upload").find(".profile-preview").attr("src",e),c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-remove").removeAttr("style"),c.closest(".wpmake-advance-user-avatar-upload").find(".WPMake_Advance_User_Avatar_take_snapshot ").attr("style","display:none"),c.closest(".wpmake-advance-user-avatar-upload").find(".WPMake_Advance_User_Avatar_upload ").attr("style","display:none"))}catch(s){r=WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_something_wrong}c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-error").remove(),c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-file-error").remove(),c.closest(".wpmake-advance-user-avatar-upload").append('<span class="wpmake-advance-user-avatar-error">'+r+"</span>"),0<t&&c.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-input").val(t),_.text(o)}})},dataURItoBlob:function(a){for(var e=(0<=a.split(",")[0].indexOf("base64")?atob:unescape)(a.split(",")[1]),a=a.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return new Blob([r],{type:a})}};n.init(jQuery),i(document).on("click",".WPMake_Advance_User_Avatar_upload",function(){i(this).closest(".wpmake-advance-user-avatar-upload").find('input[type="file"]').trigger("click")}),i(document).on("click",".WPMake_Advance_User_Avatar_take_snapshot",function(){var e=i(this),a=(Swal.fire({title:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_capture,html:'<div id="my_camera"></div>',confirmButtonText:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_capture,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_cancel_button,customClass:{container:"wpmake-advance-user-avatar-swal2-container"}}),320),r=240,t=(i(window).width()<i(window).height()&&(a=240,r=320),Webcam.set({width:a,height:r,dest_width:a,dest_height:r,crop_width:a,crop_height:r,image_format:"jpeg",jpeg_quality:90}),!1);Webcam.on("error",function(a){var e="",r="",r="WebcamError"===a.name?(e=WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_ssl_error_title,WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_ssl_error_text):(e=WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_permission_error_title,WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_permission_error_text);t=!0,swal.fire({icon:"warning",title:e,html:r,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_cancel_button_confirmation,cancelButtonColor:"#236bb0",customClass:{container:"wpmake-advance-user-avatar-swal2-container"}})}),t||(Webcam.attach("#my_camera"),i(".swal2-html-container").attr("style","display: flex;align-items: center;justify-content: center;"),i(".swal2-confirm").on("click",function(){Webcam.snap(function(a){WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_enable_cropping_interface?(Swal.fire({title:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:WPMake_Advance_User_Avatar_params.WPMake_Advance_User_Avatar_cancel_button,customClass:{container:"wpmake-advance-user-avatar-swal2-container"}}),i(".swal2-html-container").attr("style","display: flex;align-items: center;justify-content: center;"),i("#crop_container").attr("src",a),n.crop_image(e.closest(".wpmake-advance-user-avatar-upload").find('.wpmake-advance-user-avatar-upload-node input[type="file"]'))):(e.closest(".wpmake-advance-user-avatar-upload").append('<img id="blob_container" src="'+a+'" alt="your image" class="img" style="display:none;"/>'),n.send_file(e.closest(".wpmake-advance-user-avatar-upload").find('.wpmake-advance-user-avatar-upload-node input[type="file"]')))}),Webcam.reset()}),i(".swal2-cancel").on("click",function(){Webcam.reset()}))}),i(document).on("click",".wpmake-advance-user-avatar-remove",function(){n.remove_avatar(i(this))})});