jQuery(function(u){"use strict";var n={init:function(){n.process_avatar_upload()},process_avatar_upload:function(){u("body").on("change",'.wpmake-advance-user-avatar-upload-node input[type="file"]',function(){var a;this.files&&this.files[0]&&((a=new FileReader).onload=function(a){u(".img").attr("src",a.target.result)},a.readAsDataURL(this.files[0]),wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_enable_cropping_interface?(Swal.fire({title:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_cancel_button,customClass:{container:"wpmake-advance-user-avatar-swal2-container"}}),u(".swal2-cancel ").on("click",function(){u(".wpmake-advance-user-avatar-upload").find("#wpmake-advance-user-avatar-pic").val("")}),n.crop_image(u(this))):n.send_file(u(this)))})},crop_image:function(e){var r;u("#crop_container").Jcrop({aspectRatio:1,boxWidth:400,boxHeight:400,onSelect:function(a){r={x:a.x,y:a.y,w:a.w,h:a.h}},setSelect:[100,100,50,50]}),u(".swal2-confirm").on("click",function(){var a={x:r.x,y:r.y,w:r.w,h:r.h,holder_width:u("#crop_container").css("width"),holder_height:u("#crop_container").css("height")};u(".cropped_image_size").val(JSON.stringify(a)),n.send_file(e)})},remove_avatar:function(e){var a=wpmake_advance_user_avatar_params.ajax_url+"?action=wpmake_advance_user_avatar_upload_remove_avatar&security="+wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_remove_nonce;u.ajax({url:a,type:"POST",beforeSend:function(){e.text(wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_removing),e.closest(".wpmake-advance-user-avatar-upload").find("#wpmake-advance-user-avatar-pic").val(""),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-input").val(""),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-error").remove(),u(".profile-preview").attr("src","https://secure.gravatar.com/avatar/?s=96&d=mm&r=g")},complete:function(a){e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-remove").attr("style","display:none"),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake_advance_user_avatar_take_snapshot ").removeAttr("style"),e.closest(".wpmake-advance-user-avatar-upload").find(".wpmake_advance_user_avatar_upload ").removeAttr("style"),e.closest(".wpmake-advance-user-avatar-upload").find('input[type="file"]').off("click")}})},send_file:function(i){var a=wpmake_advance_user_avatar_params.ajax_url+"?action=wpmake_advance_user_avatar_upload_method_upload&security="+wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_upload_nonce,e=new FormData,r="",v=(wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_enable_cropping_interface?r=u("#crop_container").attr("src"):(r=u("#blob_container").attr("src"),console.log("2")),i[0].files[0]?e.append("file",i[0].files[0]):(r=n.dataURItoBlob(r),r=new File([r],"snapshot.jpg"),e.append("file",r)),e.append("cropped_image",u(".cropped_image_size").val()),e.append("valid_extension",u('input[name="profile-pic"]').attr("accept")),e.append("max_uploaded_size",u('input[name="profile-pic"]').attr("size")),i.closest(".wpmake-advance-user-avatar-upload").find(".wpmake_advance_user_avatar_upload")),d=v.text();u.ajax({url:a,data:e,type:"POST",processData:!1,contentType:!1,beforeSend:function(){v.text(wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_uploading)},complete:function(a){var e="",r=0,t="",n=(i.parent().parent().parent().find(".wpmake-advance-user-avatar-error").remove(),i.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-input").val(""),'<img src="'+wpmake_advance_user_avatar_params.wpmake_assets_url+'/images/error.png" width="30px" />'),s=!1;try{var c=JSON.parse(a.responseText);if("undefined"==typeof c.success||"undefined"==typeof c.data)throw wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_something_wrong;e=c.data.message,c.success||(e=n+e,s=!0);var _,p='<img src="'+wpmake_advance_user_avatar_params.wpmake_assets_url+'/images/success.png" width="30px" />';c.success&&(_=wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_upload_success_message,r=c.data.attachment_id,t=c.data.profile_picture_url,u(".wpmake-advance-user-avatar-container").find(".profile-preview").attr("src",t),i.closest(".wpmake-advance-user-avatar-upload").find(".profile-preview").attr("src",t),i.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-remove").removeAttr("style"),i.closest(".wpmake-advance-user-avatar-upload").find(".wpmake_advance_user_avatar_take_snapshot ").attr("style","display:none"),i.closest(".wpmake-advance-user-avatar-upload").find(".wpmake_advance_user_avatar_upload ").attr("style","display:none"),i.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-error").remove(),i.closest(".wpmake-advance-user-avatar-upload").append('<div class="wpmake-advance-user-avatar-success">'+p+_+"</div>"))}catch(o){e=n+wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_something_wrong,s=!0}s&&(i.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-error").remove(),i.closest(".wpmake-advance-user-avatar-upload").append('<div class="wpmake-advance-user-avatar-error">'+e+"</div>")),0<r&&i.closest(".wpmake-advance-user-avatar-upload").find(".wpmake-advance-user-avatar-input").val(r),v.text(d),u(document).trigger("wpmake_advance_user_avatar_ajax_complete")}})},dataURItoBlob:function(a){for(var e=(0<=a.split(",")[0].indexOf("base64")?atob:unescape)(a.split(",")[1]),a=a.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return new Blob([r],{type:a})}};n.init(jQuery),u(document).on("click",".wpmake_advance_user_avatar_upload",function(){u(this).closest(".wpmake-advance-user-avatar-upload").find('input[type="file"]').trigger("click")}),u(document).on("click",".wpmake_advance_user_avatar_take_snapshot",function(){var e=u(this),a=(Swal.fire({title:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_capture,html:'<div id="my_camera"></div>',confirmButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_capture,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_cancel_button,customClass:{container:"wpmake-advance-user-avatar-swal2-container"}}),320),r=240,t=(u(window).width()<u(window).height()&&(a=240,r=320),Webcam.set({width:a,height:r,dest_width:a,dest_height:r,crop_width:a,crop_height:r,image_format:"jpeg",jpeg_quality:90}),!1);Webcam.on("error",function(a){var e="",r="",r="WebcamError"===a.name?(e=wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_ssl_error_title,wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_ssl_error_text):(e=wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_permission_error_title,wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_permission_error_text);t=!0,swal.fire({icon:"warning",title:e,html:r,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_cancel_button_confirmation,cancelButtonColor:"#236bb0",customClass:{container:"wpmake-advance-user-avatar-swal2-container"}})}),t||(Webcam.attach("#my_camera"),u(".swal2-html-container").attr("style","display: flex;align-items: center;justify-content: center;"),u(".swal2-confirm").on("click",function(){Webcam.snap(function(a){wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_enable_cropping_interface?(Swal.fire({title:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:wpmake_advance_user_avatar_params.wpmake_advance_user_avatar_cancel_button,customClass:{container:"wpmake-advance-user-avatar-swal2-container"}}),u(".swal2-html-container").attr("style","display: flex;align-items: center;justify-content: center;"),u("#crop_container").attr("src",a),n.crop_image(e.closest(".wpmake-advance-user-avatar-upload").find('.wpmake-advance-user-avatar-upload-node input[type="file"]'))):(e.closest(".wpmake-advance-user-avatar-upload").append('<img id="blob_container" src="'+a+'" alt="your image" class="img" style="display:none;"/>'),n.send_file(e.closest(".wpmake-advance-user-avatar-upload").find('.wpmake-advance-user-avatar-upload-node input[type="file"]')))}),Webcam.reset()}),u(".swal2-cancel").on("click",function(){Webcam.reset()}))}),u(document).on("click",".wpmake-advance-user-avatar-remove",function(){n.remove_avatar(u(this))}),u(document).on("wpmake_advance_user_avatar_ajax_complete",function(){setTimeout(()=>{u(document).find(".wpmake-advance-user-avatar-error, .wpmake-advance-user-avatar-success").remove()},5e3)})});